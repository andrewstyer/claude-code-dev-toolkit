# Bug Archiving Guide

## Overview

The `archive-fixed-bugs.sh` script helps keep `bugs.yaml` manageable by moving resolved bugs to monthly archive files. This prevents the active bug list from growing too large while preserving complete historical records.

## When to Archive

Archive bugs when:
- `bugs.yaml` exceeds 50 bugs
- You complete a sprint with multiple resolved bugs
- Monthly cleanup (recommended)
- Bug list is becoming hard to navigate

## How It Works

The script:
1. Identifies all bugs with `status: resolved`
2. Moves them to `archive/bugs/YYYY-MM.yaml`
3. Adds `archived_at` timestamp to each bug
4. Removes resolved bugs from `bugs.yaml`
5. Preserves `nextId` counter
6. Maintains data consistency

## Usage

### Basic Usage

```bash
# From project root
./scripts/archive-fixed-bugs.sh
```

The script will:
1. Show current bug counts
2. List bugs to be archived
3. Ask for confirmation
4. Perform archival
5. Show summary

### Example Output

```
üì¶ Archiving resolved bugs from bugs.yaml...

Current bugs.yaml status:
  Total bugs: 12
  Resolved bugs: 5
  Active bugs: 7

Bugs to be archived:
  ‚Ä¢ BUG-001: Timeline crashes on scroll (resolved at: 2025-11-15T16:30:00Z)
  ‚Ä¢ BUG-004: Search crashes with emoji (resolved at: 2025-11-14T11:20:00Z)
  ‚Ä¢ BUG-007: Login fails on Samsung (resolved at: 2025-11-18T09:15:00Z)
  ‚Ä¢ BUG-009: Export button hidden (resolved at: 2025-11-19T14:20:00Z)
  ‚Ä¢ BUG-012: Notification delay (resolved at: 2025-11-20T11:45:00Z)

Archive these 5 resolved bugs? (y/N) y

Extracting resolved bugs...
  Archiving BUG-001...
  Archiving BUG-004...
  Archiving BUG-007...
  Archiving BUG-009...
  Archiving BUG-012...
Updating bugs.yaml...
‚úÖ Successfully archived 5 bugs

‚úÖ Archival complete
   Archived: 5 bugs ‚Üí archive/bugs/2025-11.yaml
   Remaining in bugs.yaml: 7 active bugs

Summary:
   Archive location: archive/bugs/2025-11.yaml
   Archive contains: 5 bugs total
   bugs.yaml now has: 7 bugs

Next steps:
   1. Review archived bugs: cat archive/bugs/2025-11.yaml
   2. Verify bugs.yaml: cat bugs.yaml
   3. Update index if needed: cp bugs.yaml docs/bugs/index.yaml
   4. Commit changes: git add bugs.yaml archive/bugs/2025-11.yaml && git commit -m 'chore: archive 5 resolved bugs'

Tip: Run this script monthly or when bugs.yaml exceeds 50 bugs
```

## Archive File Format

Archive files are organized by month: `archive/bugs/YYYY-MM.yaml`

```yaml
# Archived Bugs - 2025-11
# Bugs resolved and archived from bugs.yaml
# This file is automatically generated by scripts/archive-fixed-bugs.sh

archivedAt: "2025-11-21T23:42:46Z"
archivedCount: 5

bugs:
  - id: BUG-001
    title: Timeline crashes on scroll
    severity: P0
    status: resolved
    # ... all original bug fields ...
    resolved_at: '2025-11-15T16:30:00Z'
    archived_at: '2025-11-21T23:42:46Z'  # Added by archival script

  - id: BUG-004
    # ... next bug ...
```

## Safety Features

### Backup
- Creates `bugs.yaml.backup` before modifying
- Restores backup if verification fails

### Verification
- Counts bugs before and after
- Ensures correct number removed
- Fails safely if mismatch detected

### Incremental Archiving
- Appends to existing archive files
- Preserves previously archived bugs
- Updates `archivedCount` automatically

## Workflow Integration

### After Completing a Sprint

```bash
# 1. Complete sprint (marks bugs as resolved)
# User or Claude: "complete sprint"

# 2. Archive resolved bugs
./scripts/archive-fixed-bugs.sh

# 3. Commit changes
git add bugs.yaml archive/bugs/*.yaml
git commit -m "chore: archive resolved bugs from SPRINT-XXX"
git push
```

### Monthly Cleanup

```bash
# First day of month
./scripts/archive-fixed-bugs.sh

# Archive previous month's bugs
# Commit and push
```

## Searching Archived Bugs

### Find Bug by ID

```bash
# Search all archives
grep -r "id: BUG-123" archive/bugs/

# Search specific month
grep "id: BUG-123" archive/bugs/2025-11.yaml
```

### Find Bugs by Keyword

```bash
# Find all crashes
grep -r "crash" archive/bugs/ | grep "title:"

# Find P0 bugs
grep -r "severity: P0" archive/bugs/
```

### List All Archived Bugs

```bash
# Count by month
for file in archive/bugs/*.yaml; do
  count=$(yq '.bugs | length' "$file" 2>/dev/null || echo 0)
  echo "$(basename $file): $count bugs"
done
```

## Troubleshooting

### "yq not found"

```bash
# Install yq
pip install yq

# Or on macOS
brew install yq
```

### "bugs.yaml not found"

Make sure you're in the project root directory where `bugs.yaml` exists.

```bash
# Check current directory
ls -la bugs.yaml

# If in wrong directory, cd to project root
cd /path/to/project
```

### "No resolved bugs to archive"

This means all bugs in `bugs.yaml` have status other than "resolved":
- `triaged` - Bug reported, not scheduled
- `scheduled` - Assigned to sprint
- `in-progress` - Being worked on
- `resolved` - Fixed and ready to archive ‚úì

Only `resolved` bugs are archived.

### Archive File Already Exists

The script appends to existing archive files, so this is normal if you run it multiple times in the same month.

## Best Practices

### When to Archive

‚úÖ **Good times:**
- After sprint completion
- Monthly cleanup
- When bugs.yaml > 50 bugs
- Before major refactoring

‚ùå **Avoid archiving:**
- While actively fixing bugs
- Before sprint completion
- When bugs might be reopened

### Archive Retention

**Keep archives for:**
- Historical reference
- Bug pattern analysis
- Resolution time metrics
- Compliance/auditing

**Consider archiving archives:**
- Older than 2 years ‚Üí compress
- Older than 5 years ‚Üí move to cold storage
- Never delete (disk space is cheap)

### Git Commits

```bash
# Good commit messages
git commit -m "chore: archive 5 resolved bugs from SPRINT-003"
git commit -m "chore: monthly bug archival (November 2025)"

# Include stats
git commit -m "chore: archive 12 resolved bugs
- SPRINT-003: 5 bugs
- SPRINT-004: 7 bugs
- Remaining active bugs: 8"
```

## Integration with Skills

### completing-sprints Skill

The `completing-sprints` skill marks bugs as `resolved`. After completing a sprint:

```bash
# 1. Complete sprint (via skill)
# 2. Archive resolved bugs
./scripts/archive-fixed-bugs.sh
```

### fixing-bugs Skill

The `fixing-bugs` skill marks bugs as `fixed` ‚Üí `resolved` when complete. Archive periodically:

```bash
# After fixing several bugs
./scripts/archive-fixed-bugs.sh
```

## Future Enhancements

Potential improvements:
- Archive to quarterly files (YYYY-QX.yaml) instead of monthly
- Auto-archive after N days resolved
- Integration with completing-sprints skill
- Archive stats dashboard
- Compress old archives automatically

## See Also

- [Feature Management Extension](../extensions/feature-management/README.md)
- [Completing Sprints Skill](../extensions/feature-management/skills/completing-sprints/SKILL.md)
- [Fixing Bugs Skill](../skills/fixing-bugs/SKILL.md)
- [archive-handoff.sh](../scripts/archive-handoff.sh) - Similar pattern for HANDOFF.md
